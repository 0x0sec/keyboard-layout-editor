<!--***********************************************
KEYBOARD LAYOUT EDITOR
Copyright (C) 2013-2015 Ian Prest
All rights reserved.
************************************************-->
<!DOCTYPE html>
<html ng-app="kbApp">
<head>
<title>Keyboard Layout Editor</title>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" media="screen">
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/hint.min.css">
<link rel="stylesheet" type="text/css" href="css/colorpicker.min.css">
<link rel="stylesheet" type="text/css" href="kb.css">
<script type="text/javascript" src="js/angular.min.js"></script>
<script type="text/javascript" src="js/angular-sanitize.min.js"></script>
<script type="text/javascript" src="js/ui-utils.min.js"></script>
<script type="text/javascript" src="js/jquery-2.0.2.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/urlon.js"></script>
<script type="text/javascript" src="js/md5.js"></script>
<script type="text/javascript" src="js/jsonl.min.js"></script>
<script type="text/javascript" src="js/color.js"></script>
<script type="text/javascript" src="js/marked.min.js"></script>
<script type="text/javascript" src="js/FileSaver.min.js"></script>
<script type="text/javascript" src="js/ng-file-upload.min.js"></script>
<script type="text/javascript" src="js/draganddrop.min.js"></script>
<script type="text/javascript" src="js/bootstrap-colorpicker-module.min.js"></script>
<script type="text/javascript" src="extensions.js"></script>
<script type="text/javascript" src="render.js"></script>
<script type="text/javascript" src="serial.js"></script>
<script type="text/javascript" src="utils.js"></script>
<script type="text/javascript" src="kb.js"></script>
</head>
<body ng-controller="kbCtrl"
      ng-mouseup="selectRelease($event)"
      ng-mousemove="selectMove($event)"
      ui-keydown="{'shift-191' : 'showHelp($event)',
                  112 : 'showHelp($event)',
                  118 : 'showOptions($event)',
                  'ctrl-83' : 'save($event)' }">
<div id="wrap">

<!--***********************************************
Nav Bar / Header
************************************************-->
<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
  <div class="navbar-header">
    <!-- Hamburger menu, when width is too small -->
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>

    <!-- Main branding icon/title -->
    <a class="navbar-brand" href="#"><i class="fa fa-keyboard-o"></i> keyboard-layout-editor.com</a>
  </div>
  <div class="collapse navbar-collapse navbar-ex1-collapse">

    <!-- Left-aligned NavBar buttons -->
    <ul class="nav navbar-nav">
      <!-- Presets dropdown -->
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-keyboard-o"></i> Preset <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li ng-repeat="(k,v) in layouts"><a ng-click="loadPreset(v)" href="#">{{k}}</a></li>
          <li class="divider"></li>
          <li ng-repeat="(k,v) in samples"><a ng-click="loadSample(v)" href="#">{{k}}</a></li>
        </ul>
      </li>

      <!-- Color swatches dropdown -->
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-th"></i> Color Swatches <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li ng-repeat="pal in palettes"><a ng-click="loadPalette(pal)" href="#">{{pal.name}}</a></li>
        </ul>
      </li>
    </ul>

    <!-- Right-aligned NavBar buttons -->
    <ul class="nav navbar-nav navbar-right" style="">
      <!-- Options button -->
      <li><a href="#" ng-click="showOptions()"><i class="fa fa-cog"></i> Options</a></li>
      <!-- Permalink button -->
      <li><a ng-href="{{getPermalink()}}" target="_blank" ng-click="dirty = false"><i class="fa fa-link"></i> Permalink</a></li>
    </ul>
  </div>
</nav>

<div class="body">

  <!--***********************************************
  Main Toolbar
  ************************************************-->
  <!-- Add Key button w/dropdown -->
  <div class="btn-group">
    <button type="button" class="btn btn-primary" ng-click="addKey()"><i class="fa fa-plus-circle"></i> Add Key</button>
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
      <li><a ng-click="addKeys(1)">Add 1 Key</a></li>
      <li><a ng-click="addKeys(5)">Add 5 Keys</a></li>
      <li><a ng-click="addKeys(10)">Add 10 Keys</a></li>
      <li><a ng-click="addKeys(25)">Add 25 Keys</a></li>
      <li class="divider" ng-class="{hidden: !specialKeys}"></li>
      <li ng-repeat="(k,v) in specialKeys"><a ng-click="addKey(v)">Add '{{k}}' Key</a></li>
    </ul>
  </div>

  <!-- Delete Key button -->
  <div class="btn-group">
    <button type="button" class="btn btn-danger" ng-class="{disabled:selectedKeys.length<1}" ng-click="deleteKeys()">
      <i class="fa fa-minus-circle"></i> Delete Keys
    </button>
  </div>

  <!-- Undo/Redo button group -->
  <div class="btn-group">
    <button type="button" class="btn btn-default" ng-class="{disabled:!canUndo()}" ng-click="undo()"><i class="fa fa-undo"></i> Undo</button>
    <button type="button" class="btn btn-default" ng-class="{disabled:!canRedo()}" ng-click="redo()"><i class="fa fa-repeat"></i> Redo</button>
  </div>

  <!-- Clipboard button group -->
  <div class="btn-group">
    <button type="button" class="btn btn-default" ng-class="{disabled:!canCopy()}" ng-click="cut()"><i class="fa fa-cut"></i> Cut</button>
    <button type="button" class="btn btn-default" ng-class="{disabled:!canCopy()}" ng-click="copy()"><i class="fa fa-copy"></i> Copy</button>
    <button type="button" class="btn btn-default" ng-class="{disabled:!canPaste()}" ng-click="paste()"><i class="fa fa-paste"></i> Paste</button>
  </div>
  <!-- Save button (right aligned) -->
  <div class="btn-group pull-right">
    <button type="button" class="btn btn-success" ng-class="{disabled:!canSave()}" ng-click="save()"><i class="fa fa-save"></i> Save</button>
  </div>


  <!--***********************************************
  Main Keyboard Preview/Editor area
  ************************************************-->
  <div id="keyboard"
     tabindex="0"
     ng-style="{height: kbHeight + 'px', 'background-color': keyboard.meta.backcolor}"
     ui-keydown="{ left:'moveKeys(-moveStep,0,$event)',
                 right:'moveKeys(moveStep,0,$event)',
                 up:'moveKeys(0,-moveStep,$event)',
                 down:'moveKeys(0,moveStep,$event)',
                 'shift-left':'sizeKeys(-sizeStep,0,$event)',
                 'shift-right':'sizeKeys(sizeStep,0,$event)',
                 'shift-up':'sizeKeys(0,-sizeStep,$event)',
                 'shift-down':'sizeKeys(0,sizeStep,$event)',
                 'pageup':'rotateKeys(-rotateStep,$event)',
                 'pagedown':'rotateKeys(rotateStep,$event)',
                 'ctrl-left':'moveCenterKeys(-moveStep,0,$event)',
                 'ctrl-right':'moveCenterKeys(moveStep,0,$event)',
                 'ctrl-up':'moveCenterKeys(0,-moveStep,$event)',
                 'ctrl-down':'moveCenterKeys(0,moveStep,$event)',
                 delete:'deleteKeys()',
                 insert:'addKey()',
                 74: 'prevKey($event)',
                 75: 'nextKey($event)',
                 'shift-74': 'prevKey($event)',
                 'shift-75': 'nextKey($event)',
                 113: 'focusEditor()',
                 esc: 'unselectAll()',
                 'ctrl-65': 'selectAll($event)',
                 'ctrl-67 ctrl-45': 'copy($event)',
                 'ctrl-88 shift-46': 'cut($event)',
                 'ctrl-86 shift-45': 'paste($event)',
                 'ctrl-90' : 'undo()',
                 'ctrl-shift-90' : 'redo()',
                 'ctrl-89' : 'redo()' }"
     ng-mousedown="selectClick($event)"
     ngf-drop="true" ngf-change="uploadJson($files, $event)" ngf-drag-over-class="drag-over">

    <div ng-repeat="key in keys()"
       class="key {{key.profile}}"
       style="{{rotationStyle(key)}}"
       ng-mouseover="hoveredKey=key"
       ng-mouseleave="hoveredKey=null"
       ng-class="{hover: hoveredKey==key, selected: selectedKeys.indexOf(key)>=0}"
       ng-bind-html="key.html">
    </div>

    <div style='clear:both'></div>
    {{calcKbHeight()}}
  </div>
  <div id="selectionRectangle" ng-style="{display:selRect.display, left:selRect.l+'px', width:selRect.w+'px', top:selRect.t+'px', height:selRect.h+'px'}"></div>
  <div id="rotationCrosshairs" ng-style="{display:multi.crosshairs, left:(keyboardLeft()+multi.crosshairs_x-5)+'px', top:(keyboardTop()+multi.crosshairs_y-7)+'px'}"><i class="fa fa-crosshairs"></i></div>


  <!--***********************************************
  Editor controls
  ************************************************-->

  <!-- Tab strip -->
  <ul class="nav nav-tabs">
    <li ng-class="{active:selTab==0}"><a ng-click="selTab=0" data-toggle="tab"><i class="fa fa-edit"></i> Properties</a></li>
    <li ng-class="{active:selTab==1}"><a ng-click="selTab=1" data-toggle="tab"><i class="fa fa-keyboard-o"></i> Keyboard Properties</a></li>
    <li ng-class="{active:selTab==2}"><a ng-click="selTab=2" data-toggle="tab"><i class="fa fa-code"></i> Raw data</a></li>
  </ul>
  <div id="tab-content" class='col-md-12 col-lg-12 row' ui-keydown="{esc:'focusKb()'}">

    <!-- PROPERTIES EDITOR -->
    <div id="properties" ng-class="{hidden:selTab!=0}">
      <form class="form-horizontal col-sm-8 col-md-5 col-lg-5">

        <!-- Top Label -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="labeleditor0">Top Label:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline">
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify the primary text of the keycap; typically displayed top-left, unless the centering options are used."
                     ui-on-Drop="dropSwatch($data,$event,true,0)" drop-channel="dragColor">
                  <input id="labeleditor0" class="form-control" size="6" type='text'
                         ng-model="multi.labels[0]"
                         ng-change="updateMulti('labels',0)"
                         ng-blur="validateMulti('labels',0)"
                         ng-disabled="selectedKeys.length<1">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                           ng-style="{'background-color':getTextColor(multi.text,0)}"
                           ng-model="multi.text[0]"
                           ng-change="updateMulti('text',0)"
                           colorpicker="hex"
                           colorpicker-close-on-select="true"
                           colorpicker-with-input="true"
                           ng-disabled="selectedKeys.length<1">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify secondary text for the keycap; typically displayed top-right."
                     ui-on-Drop="dropSwatch($data,$event,true,2)" drop-channel="dragColor">
                  <input id="labeleditor2" class="form-control" size="6" type='text'
                         ng-model="multi.labels[2]"
                         ng-change="updateMulti('labels',2)"
                         ng-blur="validateMulti('labels',2)"
                         ng-disabled="selectedKeys.length<1 || multi.centerx">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                            ng-style="{'background-color':getTextColor(multi.text,2)}"
                            ng-model="multi.text[2]"
                            ng-change="updateMulti('text',2)"
                            colorpicker="hex"
                            colorpicker-close-on-select="true"
                            colorpicker-with-input="true"
                            ng-disabled="selectedKeys.length<1 || multi.centerx">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <div class="checkbox hint--top hint--rounded"
                     data-hint="Center the keycap text horizontally; the labels that would normally be left-aligned will be centered instead.">
                  <label>
                    <input id="centerx" type="checkbox"
                           ng-model="multi.centerx"
                           ng-change="updateMulti('centerx')"
                           ng-blur="validateMulti('centerx')"
                           ng-disabled="selectedKeys.length<1">
                    Center X
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Center Label -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="labeleditor6">Center Label:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline">
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify secondary text for the keycap; typically displayed center-left.  You can specify a horizontal rule with <hr>."
                     ui-on-Drop="dropSwatch($data,$event,true,6)" drop-channel="dragColor">
                  <input id="labeleditor6" class="form-control" size="6" type='text'
                         ng-model="multi.labels[6]"
                         ng-change="updateMulti('labels',6)"
                         ng-blur="validateMulti('labels',6)"
                         ng-disabled="selectedKeys.length<1 || multi.centery">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                           ng-style="{'background-color':getTextColor(multi.text,6)}"
                           ng-model="multi.text[6]"
                           ng-change="updateMulti('text',6)"
                           colorpicker="hex"
                           colorpicker-close-on-select="true"
                           colorpicker-with-input="true"
                           ng-disabled="selectedKeys.length<1 || multi.centery">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify secondary text for the keycap; typically displayed center-right."
                     ui-on-Drop="dropSwatch($data,$event,true,7)" drop-channel="dragColor">
                  <input id="labeleditor7" class="form-control" size="6" type='text'
                         ng-model="multi.labels[7]"
                         ng-change="updateMulti('labels',7)"
                         ng-blur="validateMulti('labels',7)"
                         ng-disabled="selectedKeys.length<1 || multi.centery || multi.centerx">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                            ng-style="{'background-color':getTextColor(multi.text,7)}"
                            ng-model="multi.text[7]"
                            ng-change="updateMulti('text',7)"
                            colorpicker="hex"
                            colorpicker-close-on-select="true"
                            colorpicker-with-input="true"
                            ng-disabled="selectedKeys.length<1 || multi.centery || multi.centerx">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <div class="checkbox hint--top hint--rounded"
                     data-hint="Center the keycap text vertically; the labels that would normally be top-aligned will be centered instead.">
                  <label>
                    <input id="centery" type="checkbox"
                           ng-model="multi.centery"
                           ng-change="updateMulti('centery')"
                           ng-blur="validateMulti('centery')"
                           ng-disabled="selectedKeys.length<1">
                    Center Y
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom Label -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="labeleditor6">Center Label:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline">
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify secondary text for the keycap; typically displayed bottom-left."
                     ui-on-Drop="dropSwatch($data,$event,true,1)" drop-channel="dragColor">
                  <input id="labeleditor1" class="form-control" size="6" type='text'
                         ng-model="multi.labels[1]"
                         ng-change="updateMulti('labels',1)"
                         ng-blur="validateMulti('labels',1)"
                         ng-disabled="selectedKeys.length<1 || multi.centery">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                           ng-style="{'background-color':getTextColor(multi.text,1)}"
                           ng-model="multi.text[1]"
                           ng-change="updateMulti('text',1)"
                           colorpicker="hex"
                           colorpicker-close-on-select="true"
                           colorpicker-with-input="true"
                           ng-disabled="selectedKeys.length<1 || multi.centery">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify secondary text for the keycap; typically displayed bottom-right."
                     ui-on-Drop="dropSwatch($data,$event,true,3)" drop-channel="dragColor">
                  <input id="labeleditor3" class="form-control" size="6" type='text'
                         ng-model="multi.labels[3]"
                         ng-change="updateMulti('labels',3)"
                         ng-blur="validateMulti('labels',3)"
                         ng-disabled="selectedKeys.length<1 || multi.centery || multi.centerx">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                            ng-style="{'background-color':getTextColor(multi.text,3)}"
                            ng-model="multi.text[3]"
                            ng-change="updateMulti('text',3)"
                            colorpicker="hex"
                            colorpicker-close-on-select="true"
                            colorpicker-with-input="true"
                            ng-disabled="selectedKeys.length<1 || multi.centery || multi.centerx">&nbsp;</button>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Side-Print Label -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="labeleditor6">Center Label:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline">
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify the primary side-printed text for the keycap."
                     ui-on-Drop="dropSwatch($data,$event,true,4)" drop-channel="dragColor">
                  <input id="labeleditor4" class="form-control" size="6" type='text'
                         ng-model="multi.labels[4]"
                         ng-change="updateMulti('labels',4)"
                         ng-blur="validateMulti('labels',4)"
                         ng-disabled="selectedKeys.length<1">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                            ng-style="{'background-color':getTextColor(multi.text,4)}"
                            ng-model="multi.text[4]"
                            ng-change="updateMulti('text',4)"
                            colorpicker="hex"
                            colorpicker-close-on-select="true"
                            colorpicker-with-input="true"
                            ng-disabled="selectedKeys.length<1">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify secondary side-printed text for the keycap."
                     ui-on-Drop="dropSwatch($data,$event,true,5)" drop-channel="dragColor">
                  <input id="labeleditor5" class="form-control" size="6" type='text'
                         ng-model="multi.labels[5]"
                         ng-change="updateMulti('labels',5)"
                         ng-blur="validateMulti('labels',5)"
                         ng-disabled="selectedKeys.length<1 || multi.centerf">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                            ng-style="{'background-color':getTextColor(multi.text,5)}"
                            ng-model="multi.text[5]"
                            ng-change="updateMulti('text',5)"
                            colorpicker="hex"
                            colorpicker-close-on-select="true"
                            colorpicker-with-input="true"
                            ng-disabled="selectedKeys.length<1 || multi.centerf">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <div class="checkbox hint--top hint--rounded"
                     data-hint="Center the side-printed text.">
                  <label>
                    <input id="centerf" type="checkbox"
                           ng-model="multi.centerf"
                           ng-change="updateMulti('centerf')"
                           ng-blur="validateMulti('centerf')"
                           ng-disabled="selectedKeys.length<1">
                    Center
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Legend Size -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="textsizeeditor">Legend Size:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
                 data-hint="Specify the primary and secondary sizes for the keycap legends. The primary size affects only the primary text legend, while the secondary size is applied to all other legends.">
              <div class="form-group form-group-sm">
                <input id="textsizeeditor" class="form-control input-sm" size="6" type='number' min="1" max="9"
                       ng-model="multi.fontheight"
                       ng-change="updateMulti('fontheight')"
                       ng-blur="validateMulti('fontheight')"
                       ng-disabled="selectedKeys.length<1">
              </div>
              <div class="form-group form-group-sm">
                /
              </div>
              <div class="form-group form-group-sm">
                <input id="textsizeeditor" class="form-control input-sm" size="6" type='number' min="1" max="9"
                       ng-model="multi.fontheight2"
                       ng-change="updateMulti('fontheight2')"
                       ng-blur="validateMulti('fontheight2')"
                       ng-disabled="selectedKeys.length<1">
              </div>
            </div>
          </div>
        </div>

        <!-- Width -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="widtheditor">Width:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
                 data-hint="Specify the primary and secondary widths for the keycap. The secondary width is used to specify the size of non-rectangular or stepped keys.">
              <div class="form-group form-group-sm">
                <input id="widtheditor" class="form-control input-sm" size="6" type='number' min='0.5' max='12' step='{{sizeStep}}'
                       ng-model="multi.width"
                       ng-change="updateMulti('width')"
                       ng-blur="validateMulti('width')"
                       ng-disabled="selectedKeys.length<1">
              </div>
              <div class="form-group form-group-sm">
                /
              </div>
              <div class="form-group form-group-sm">
                <input class="form-control input-sm" size="6" type='number' min='0.5' max='12' step='{{sizeStep}}'
                       ng-model="multi.width2"
                       ng-change="updateMulti('width2')"
                       ng-blur="validateMulti('width2')"
                       ng-disabled="selectedKeys.length<1">
              </div>
            </div>
          </div>
        </div>

        <!-- Height -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="widtheditor">Width:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
                 data-hint="Specify the primary and secondary heights for the keycap. The secondary height is used to specify the size of non-rectangular or stepped keys.">
              <div class="form-group form-group-sm">
                <input id="heighteditor" class="form-control input-sm" size="6" type='number' min='0.5' max='12' step='{{sizeStep}}'
                       ng-model="multi.height"
                       ng-change="updateMulti('height')"
                       ng-blur="validateMulti('height')"
                       ng-disabled="selectedKeys.length<1">
              </div>
              <div class="form-group form-group-sm">
                /
              </div>
              <div class="form-group form-group-sm">
                <input class="form-control input-sm" size="6" type='number' min='0.5' max='12' step='{{sizeStep}}'
                       ng-model="multi.height2"
                       ng-change="updateMulti('height2')"
                       ng-blur="validateMulti('height2')"
                       ng-disabled="selectedKeys.length<1">
              </div>
            </div>
          </div>
        </div>

        <!-- X -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="xeditor">X:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
                 data-hint="Specify the X position of the keycap. An X-offset can also be specified to indicate how non-rectangular keys should be displayed.">
              <div class="form-group form-group-sm">
                <input id="xeditor" class="form-control input-sm" size="6" type='number' min='0' max='36' step='{{moveStep}}'
                       ng-model="multi.x"
                       ng-change="updateMulti('x')"
                       ng-blur="validateMulti('x')"
                       ng-disabled="selectedKeys.length<1">
              </div>
              <div class="form-group form-group-sm">
                +
              </div>
              <div class="form-group form-group-sm">
                <input class="form-control input-sm" size="6" type='number' min='-6' max='6' step='{{moveStep}}'
                       ng-model="multi.x2"
                       ng-change="updateMulti('x2')"
                       ng-blur="validateMulti('x2')"
                       ng-disabled="selectedKeys.length<1">
              </div>
            </div>
          </div>
        </div>

        <!-- Y -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="yeditor">Y:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
                 data-hint="Specify the Y position of the keycap. A Y-offset can also be specified to indicate how non-rectangular keys should be displayed.">
              <div class="form-group form-group-sm">
                <input id="yeditor" class="form-control input-sm" size="6" type='number' min='0' max='36' step='{{moveStep}}'
                       ng-model="multi.y"
                       ng-change="updateMulti('y')"
                       ng-blur="validateMulti('y')"
                       ng-disabled="selectedKeys.length<1">
              </div>
              <div class="form-group form-group-sm">
                +
              </div>
              <div class="form-group form-group-sm">
                <input class="form-control input-sm" size="6" type='number' min='-6' max='6' step='{{moveStep}}'
                       ng-model="multi.y2"
                       ng-change="updateMulti('y2')"
                       ng-blur="validateMulti('y2')"
                       ng-disabled="selectedKeys.length<1">
              </div>
            </div>
          </div>
        </div>

        <!-- Profile / Row -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="profileeditor">Profile / Row:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
               data-hint="Specify the profile and (optionally) the row-number of the selected keys, e.g., 'DCS R1', 'DSA', 'DSA SPACE', etc.">
              <div class="form-group form-group-sm">
                <input id="profileeditor" class="form-control input-sm" size="24" type='text'
                       ng-model="multi.profile"
                       ng-change="updateMulti('profile')"
                       ng-blur="validateMulti('profile')"
                       ng-disabled="selectedKeys.length<1">
              </div>
            </div>
          </div>
        </div>

        <!-- Key Color -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="coloreditor">Key Color:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
                 data-hint="Specify the color to use for the background of the selected keycaps.">
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm"
                     ui-on-Drop="dropSwatch($data,$event,false)" drop-channel="dragColor">
                  <input id="coloreditor" class="form-control" size="8" type='text'
                         ng-model="multi.color"
                         ng-change="updateMulti('color')"
                         ng-blur="validateMulti('color')"
                         ng-disabled="selectedKeys.length<1"
                         colorpicker="hex"
                         colorpicker-close-on-select="true"
                         colorpicker-position="top">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                            ng-style="{'background-color':multi.color}"
                            ng-model="multi.color"
                            ng-change="updateMulti('color')"
                            colorpicker="hex"
                            colorpicker-close-on-select="true"
                            colorpicker-position="top"
                            ng-disabled="selectedKeys.length<1">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm color-name">{{colorName(multi.color)}}</div>
            </div>

            <!-- Swap Colors Button -->
            <div>
              <div id="swap-colors"
                   class="hint--top hint--rounded"
                   data-hint="Swap the text and keycap colors.">
                <button class="btn btn-default"
                        ng-click="swapColors()"
                        ng-disabled="selectedKeys.length<1" >
                  <i class="fa fa-random"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Label Color -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="textcoloreditor">Label Color:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
                 data-hint="Specify the color to use for the legend text on the selected keycaps.">
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm"
                     ui-on-Drop="dropSwatch($data,$event,true,-1)" drop-channel="dragColor">
                  <input id="textcoloreditor" class="form-control" size="8" type='text'
                         ng-model="multi.text[0]"
                         ng-change="updateMulti('text',-1)"
                         ng-blur="validateMulti('text')"
                         ng-disabled="selectedKeys.length<1"
                         colorpicker="hex"
                         colorpicker-close-on-select="true"
                         colorpicker-position="top">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                            ng-style="{'background-color':multi.text[0]}"
                            ng-model="multi.text[0]"
                            ng-change="updateMulti('text',-1)"
                            colorpicker="hex"
                            colorpicker-close-on-select="true"
                            colorpicker-position="top"
                            ng-disabled="selectedKeys.length<1">&nbsp;</button>
                  </span>
                </div>
              </div>
              <div class="form-group form-group-sm color-name">{{colorName(multi.text[0])}}</div>
            </div>
          </div>
        </div>

        <!-- Rotation -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap" for="angleeditor">Rotation:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline hint--top hint--rounded"
                 data-hint="Specify the angle (in degrees) by which to rotate the keycaps, and the x &amp; y coordinates of the center of rotation.">
              <div class="form-group form-group-sm">
                <input id="angleeditor" class="form-control input-sm" size="3" type="number" min="-180" max="180" step="{{rotateStep}}"
                       ng-model="multi.rotation_angle"
                       ng-change="updateMulti('rotation_angle')"
                       ng-blur="validateMulti('rotation_angle')"
                       ng-disabled="selectedKeys.length<1">
              </div>
              <div class="form-group form-group-sm">
                &#176;
              </div>
              <div class="form-group form-group-sm">
                <input class="form-control input-sm" size="3" type="number" min="0" max="36" step="{{moveStep}}"
                       ng-model="multi.rotation_x"
                       ng-change="updateMulti('rotation_x')"
                       ng-blur="validateMulti('rotation_x')"
                       ng-disabled="selectedKeys.length<1">
              </div>
              <div class="form-group form-group-sm">
                ,
              </div>
              <div class="form-group form-group-sm">
                <input class="form-control input-sm" size="3" type="number" min="0" max="36" step="{{moveStep}}"
                       ng-model="multi.rotation_y"
                       ng-change="updateMulti('rotation_y')"
                       ng-blur="validateMulti('rotation_y')"
                       ng-disabled="selectedKeys.length<1">
              </div>
            </div>
          </div>
        </div>

        <!-- Misc -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-3 col-lg-3 text-nowrap">Misc:</label>
          <div class="col-md-9 col-lg-9">
            <div class="form-inline">
              <div class="form-group form-group-sm">
                <div class="checkbox hint--top hint--rounded"
                     data-hint="Specify whether the selected keys should be rendered slightly transparently; this is useful to draw attention to the other, non-ghosted keycaps.">
                  <label>
                    <input id="ghosteditor" type="checkbox"
                           ng-model="multi.ghost"
                           ng-change="updateMulti('ghost')"
                           ng-blur="validateMulti('ghost')"
                           ng-disabled="selectedKeys.length<1">
                    Ghosted
                  </label>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <div class="checkbox hint--top hint--rounded"
                     data-hint="Specify whether the selected keys are 'stepped', i.e., part of the key is at a lower height than the rest.  The secondary 'width' indicates the width of the stepped part.">
                  <label>
                    <input id="steppededitor" type="checkbox"
                           ng-model="multi.stepped"
                           ng-change="updateMulti('stepped')"
                           ng-blur="validateMulti('stepped')"
                           ng-disabled="selectedKeys.length<1">
                    Stepped
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

      </form>

      <div class="col-md-4 col-lg-4" ng-class="{hidden:!palette.name}">
        {{palette.name}} <a ng-href='{{palette.href}}' data-hint="{{palette.description}}" class="hint--top hint--rounded" target="_blank">(more info)</a>
        <ul id="swatches" ng-class="{disabled:selectedKeys.length<1}">
          <li ng-repeat="color in palette.colors"
             ng-style="{'background-color':color.css}"
             ng-click="clickSwatch(color,$event)"
             class="swatch hint--top"
             ng-class="{'selected-bg': color.css === multi.color, 'selected-fg': color.css === multi.text[0]}"
             data-hint="{{color.name}}"
             ui-draggable="true" drag-channel="dragColor" drag="color">
               <div class='highlight fg'></div>
               <div class='highlight bg'></div>
          </li>
        </ul>
        <div class="alert alert-warning alert-dismissable" style="margin-top:10px;"><a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>
          <i class="fa fa-info-circle"></i>
          Click on a swatch to set the color of the selected key(s), or Ctrl+Click to set the text color.  You can also drag color swatches to individual labels to set different colors for each one.
        </div>
      </div>
    </div>

    <!-- KEYBOARD PROPERTIES EDITOR -->
    <div id="kbdproperties" ng-class="{hidden:selTab!=1}">
      <form class="form-horizontal col-sm-12 col-md-12 col-lg-12">

        <!-- Keyboard Color -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-2 col-lg-1 text-nowrap" for="kbdcoloreditor">Keyboard Color:</label>
          <div class="col-md-10 col-lg-11">
            <div class="form-inline">
              <div class="form-group form-group-sm">
                <div class="input-group input-group-sm hint--top hint--rounded"
                     data-hint="Specify the background color for the keyboard.">
                  <input id="kbdcoloreditor" class="form-control" size="8" type='text'
                         ng-model="meta.backcolor"
                         ng-change="updateMeta('backcolor')"
                         ng-blur="validateMeta('backcolor')"
                         colorpicker="hex"
                         colorpicker-close-on-select="true">
                  <span class="input-group-btn">
                    <button class="btn btn-default"
                            ng-style="{'background-color':meta.backcolor}"
                            ng-model="meta.backcolor"
                            ng-change="updateMeta('backcolor')"
                            colorpicker="hex" colorpicker-close-on-select="true">&nbsp;</button>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Keyboard Name -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-2 col-lg-1 text-nowrap" for="kbdnameeditor">Keyboard Name:</label>
          <div class="col-md-10 col-lg-11 form-outdent hint--top hint--rounded"
               data-hint="Specify the name of this keyboard layout.">
            <input id="kbdnameeditor" class="form-control input-sm" type='text'
                   ng-model="meta.name"
                   ng-change="updateMeta('name')"
                   ng-blur="validateMeta('name')">
          </div>
        </div>

        <!-- Author -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-2 col-lg-1 text-nowrap" for="authoreditor">Author:</label>
          <div class="col-md-10 col-lg-11 form-outdent hint--top hint--rounded"
               data-hint="Specify the author of this keyboard layout.">
            <input id="authoreditor" class="form-control input-sm" type='text'
                   ng-model="meta.author"
                   ng-change="updateMeta('author')"
                   ng-blur="validateMeta('author')">
          </div>
        </div>

        <!-- Notes -->
        <div class="form-group form-group-sm">
          <label class="control-label col-md-2 col-lg-1 text-nowrap" for="noteseditor">Notes:</label>
          <div class="col-md-10 col-lg-11 form-outdent hint--top hint--rounded"
               data-hint="Specify any additional notes about this keyboard layout, e.g., links to manufacturers, colors used, additional credits, etc.  GitHub-Flavored Markdown is supported for rich formatting.">
            <textarea id="noteseditor" class="form-control" rows="20" spellcheck="true"
                      ng-model="meta.notes"
                      ng-change="updateMeta('notes')"
                      ng-blur="validateMeta('notes')"></textarea>
          </div>
        </div>

      </form>
    </div>

    <!-- RAW DATA EDITOR -->
    <div id="tab-rawdata" ng-class="{hidden:selTab!=2}">
      <div ngf-drop="true" ngf-change="uploadJson($files, $event)" ngf-drag-over-class="drag-over">
        <textarea id="rawdata" spellcheck="false" ng-model="serialized" ng-change="updateFromSerialized()" ng-class="{error:deserializeException!==''}" rows="20"></textarea>
      </div>
      <div style='text-align:right;margin-top:4px;'>
        <div class="btn-group btn-group-xs" role="group">
          <button type="button" class="btn btn-primary" ng-click="downloadJson()"><i class="fa fa-download"></i> Download JSON</button>
          <button ngf-select="true" class="btn btn-primary" ngf-change="uploadJson($files, $event)"><i class="fa fa-upload"></i> Upload JSON</button>
        </div>
        <div class="btn-group btn-group-xs" role="group">
          <a class="btn btn-primary" href="https://github.com/ijprest/keyboard-layout-editor/wiki/Serialized-Data-Format" target='_blank'><i class="fa fa-question-circle"></i> Raw Data Syntax</a>
        </div>
      </div>
      <div id="rawdata-error" class="alert alert-danger" style='margin-top:1em;margin-bottom:0px' ng-class="{hidden:!deserializeException}">{{deserializeException}}</div>
    </div>
  </div>
  <P></P>
  <div ng-class="{hidden:!saved}" class="alert alert-success">
    <a class="close" href="#" aria-hidden="true" ng-click="saved=false">&times;</a>
    Saved!  Your saved layout can be accessed via <a class="alert-link" ng-href="#/layouts/{{saved}}">this link</a>.
  </div>
  <div ng-class="{hidden:!saveError}" class="alert alert-danger">
    <a class="close" href="#" aria-hidden="true" ng-click="saveError=''">&times;</a>
    <P>There was an error saving your layout on the server: {{saveError}}</P>
    <P>To ensure you don't lose any data, it is recommended that you <a class="alert-link" ng-href="{{getPermalink()}}" target="_blank" ng-click="dirty = false">bookmark this permalink</a>.</P>
  </div>
  <div ng-class="{hidden:!loadError}" class="alert alert-danger">
    <a class="close" href="#" aria-hidden="true" ng-click="loadError=false">&times;</a>
    The requested layout does not exist.
  </div>
</div>
</div>

<!--***********************************************
Footer
************************************************-->
<div id="footer">
<div class="container">
  <p class="text-muted credit" style="float:left">
    Keyboard Layout Editor v{{version}} (<a href='#' ng-click="showMarkdown('CHANGELOG.md')">changelog</a>)<br/>
    Copyright &copy; 2013-2015 &mdash; Ian Prest (<a href='#' ng-click="showMarkdown('CONTRIB.md')">and contributors</a>)<br/>
    All rights reserved. (<a href='#' ng-click="showMarkdown('LICENSE.md')">LICENSE</a>)
  </p>
  <div style="float:right; text-alignment:right;">
    <a href="#" ng-click="showHelp($event)"><i class="fa fa-question-circle"></i> Help &amp; keyboard shortcuts</a><br/>
    <a href="https://github.com/ijprest/keyboard-layout-editor/issues" target="_blank"><i class="fa fa-bug"></i> Found a bug?</a><br/>
    <a href="https://github.com/ijprest/keyboard-layout-editor" target="_blank"><i class="fa fa-github"></i> Code hosted on GitHub</a><br/>
  </div>
</div>
</div>

<!--***********************************************
Help Dialog
************************************************-->
<div class="modal fade" id="helpDialog" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">How to use keyboard-layout-editor.com</h4>
      </div>
      <div class="modal-body">
        <h5>Getting Started:</h5>
        <ul>
          <li>Try loading one of the preset layouts from the dropdown at the top of the page; it will give you a good idea of the editor's capabilities.</li>
          <li>Select a key in the editor by clicking on it; then try changing the various properties in the property-editor form.</li>
          <li>You can select multiple keys by holding down CTRL and clicking on them, or extend the current selection by SHIFT-clicking on an item.  You can also drag a marquee rectangle around the keys you want to select.</li>
          <li>Try the keyboard shortcuts (described below); they make editing various properties much quicker.</li>
          <li>You can save your layout to the server by clicking the 'Save' button on the toolbar.</li>
          <li>You can save your layout locally by bookmarking the 'Permalink' (at the top of the page) in your bookmarks list.</li>
        </ul>

        <h5>Global Keyboard Shortcuts:</h5>
        <dl class='dl-horizontal'>
          <dt><kbd>F1</kbd> / <kbd>?</kbd></dt><dd>Show this help dialog</dd>
          <dt><kbd>F7</kbd></dt><dd>Show the Options dialog</dd>
          <dt><kbd>Ctrl&ndash;S</kbd></dt><dd>Save your layout (on the server)</dd>
        </dl>

        <h5>Editor Keyboard Shortcuts (these require that the editor has input focus):</h5>
        <dl class='dl-horizontal' style='float:left;width:50%;'>
          <dt><kbd>↑↓←→</kbd></dt><dd>Move the selected keys</dd>
          <dt><kbd>Shift&ndash;↑↓←→</kbd></dt><dd>Resize the selected keys</dd>
          <dt><kbd>Ctrl&ndash;↑↓←→</kbd></dt><dd>Move the center of rotation for the selected keys</dd>
          <dt><kbd>PgUp</kbd> / <kbd>PgDn</kbd></dt><dd>Change the angle of rotation for the selected keys</dd>
          <dt><kbd>Ins</kbd></dt><dd>Add a new key</dd>
          <dt><kbd>Del</kbd></dt><dd>Delete the selected keys</dd>
          <dt><kbd>F2</kbd></dt><dd>Edit the text of the selected key</dd>
        </dl>
        <dl class='dl-horizontal' style='float:left;width:50%;'>
          <dt><kbd>Ctrl&ndash;A</kbd> / <kbd>Esc</kbd></dt><dd>Select / deselect all keys</dd>
          <dt><kbd>J</kbd> / <kbd>K</kbd></dt><dd>Select the previous / next key in the editor.</dd>
          <dt><kbd>Ctrl&ndash;Z</kbd></dt><dd>Undo</dd>
          <dt><kbd>Ctrl&ndash;Shift&ndash;Z</kbd> or <kbd>Ctrl&ndash;Y</kbd></dt><dd>Redo</dd>
          <dt><kbd>Ctrl&ndash;X</kbd> or <kbd>Shift&ndash;Del</kbd></dt><dd>Cut the selected keys</dd>
          <dt><kbd>Ctrl&ndash;C</kbd> or <kbd>Ctrl&ndash;Ins</kbd></dt><dd>Copy the selected keys</dd>
          <dt><kbd>Ctrl&ndash;V</kbd> or <kbd>Shift&ndash;Ins</kbd></dt><dd>Paste keys from the clipboard</dd>
        </dl>
        <p>&nbsp;</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

<!--***********************************************
Markdown dialog for displaying README, etc.
************************************************-->
<div class="modal fade" id="markdownDialog" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" style='width:90%;'>
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">{{markdownTitle}}</h4>
      </div>
      <div class="modal-body" ng-bind-html="markdownContent">&nbsp;</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

<!--***********************************************
Options Dialog
************************************************-->
<div class="modal fade" id="optionsDialog" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" style='width:60%;'>
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Options</h4>
      </div>
      <div class="modal-body">
        <h5>Editor Step Sizes:</h5>
        <div class="form-horizontal">
          <div class="form-group form-group-sm">
            <label for="moveStepEditor" class="col-sm-6 col-md-3 col-lg-2 control-label">Move Step:</label>
            <div class="col-sm-6 col-md-9 col-lg-10">
              <div class="form-inline">
                <div class="form-group form-group-sm">
                  <div class="input-group input-group-sm hint--top hint--rounded"
                       data-hint="Controls the step size when moving keys around the keyboard layout.">
                    <input id="moveStepEditor" class="form-control" type="number" min="0.05" max="2.5" step="0.05" size="6" ng-model="moveStep">
                    <span class="input-group-addon">units</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group form-group-sm">
            <label for="sizeStepEditor" class="col-sm-6 col-md-3 col-lg-2 control-label">Size Step:</label>
            <div class="col-sm-6 col-md-9 col-lg-10">
              <div class="form-inline">
                <div class="form-group form-group-sm">
                  <div class="input-group input-group-sm hint--top hint--rounded"
                       data-hint="Controls the step size when resizing keys in the keyboard layout.">
                    <input id="sizeStepEditor" class="form-control" type="number" min="0.05" max="2.5" step="0.05" size="6" ng-model="sizeStep">
                    <span class="input-group-addon">units</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group form-group-sm">
            <label for="rotateStepEditor" class="col-sm-6 col-md-3 col-lg-2 control-label">Rotate Step:</label>
            <div class="col-sm-6 col-md-9 col-lg-10">
              <div class="form-inline">
                <div class="form-group form-group-sm">
                  <div class="input-group input-group-sm hint--top hint--rounded"
                       data-hint="Controls the step size when rotating keys in the keyboard layout.">
                    <input id="rotateStepEditor" class="form-control" type="number" min="1" max="90" step="1" size="6" ng-model="rotateStep">
                    <span class="input-group-addon">degrees</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>